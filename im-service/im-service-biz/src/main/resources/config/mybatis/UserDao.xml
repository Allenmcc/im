<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.starsea.im.biz.dao.UserDao">


    <select id="queryUser"  resultType="userEntity">
        <![CDATA[
        select * from test.user WHERE OpenId = #{openId}
    ]]>
    </select>

    <select id="queryUserByOpenId"  resultType="userEntity">
        <![CDATA[
        select * from test.user WHERE OpenId = #{openId} order by id desc limit 1
    ]]>
    </select>

    <select id="queryUsers"  resultType="userEntity">
        <![CDATA[
        select * from test.user
    ]]>
    </select>

    <select id="queryChildrenUsers"  resultType="userEntity">
        <![CDATA[
        select * from test.user where Teacher=#{teacher}
    ]]>
    </select>

    <select id="queryAllChildren"  resultType="userEntity">
        <![CDATA[
        select * from test.user where Role="家长"
    ]]>
    </select>
    <select id="queryAllTeacher"  resultType="userEntity">
        <![CDATA[
        select * from test.user where Role="老师"
    ]]>
    </select>

    <insert id="addUser" parameterType="userEntity">
        insert into test.user(OpenId,Name,MyClass,School,Organization,CreateTime,Role,Teacher)
                    values(#{openId},#{name},#{myClass},#{school},#{organization},#{createTime},#{role},#{teacher})
    </insert>

    <insert id="addRegister" parameterType="teacherRegisterEntity">
        insert into test.register(OpenId,TeacherName,TeacherSchool,TeacherCommand,CreateTime)
        values(#{openId},#{teacherName},#{teacherSchool},#{teacherCommand},#{createTime})
    </insert>

    <select id="queryTeacherRegister"  resultType="teacherRegisterEntity">
        select * from test.register
    </select>

    <delete id="deleteTeacherRegister">
        delete from test.register where OpenId in
        <foreach collection="array" item="registerOpenId" index="index"
                 open="(" close=")" separator=",">
            #{registerOpenId}
        </foreach>
    </delete>

    <insert id="passTeacherRegister">
        insert into test.user (OpenId,Role,Name,School,Command,CreateTime)
        values
        <foreach collection="list" item="item" index="index" separator="," >
            (#{item.openId},'老师',#{item.teacherName},#{item.teacherSchool},#{item.teacherCommand},#{item.createTime})
        </foreach>
    </insert>

    <select id="queryTeacher"  resultType="teacherRegisterEntity" parameterType="map">
        select * from test.user where Role='老师' AND Name=#{teacherName} AND Command=#{command}
    </select>
</mapper>
<!DOCTYPE html>
<html>
<head><meta charset="utf-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="/static/open/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- styles -->
    <link href="/static/css/styles.css" rel="stylesheet">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="/static/js/jquery-1.11.0.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/static/open/bootstrap/js/bootstrap.min.js"></script>
    <script src="static/js/cookie_openid.js"></script>
    <script src="static/js/util.js"></script>
</head>
<body class="login-bg">
<div class="header">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <!-- Logo -->
                <div class="logo">
                    <h1><a href="#">Ejia</a></h1>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="page-content container">
    <div class="row">
        <div class="col-md-4 col-md-offset-4">
            <div class="login-wrapper">
                <div class="box">
                    <div class="content-wrap">
                        <h6>Ejia</h6>
                        身份：&nbsp;&nbsp;&nbsp;家长：<input type="radio" checked="checked" name="power" value="家长" class="role b" />&nbsp;
                        老师：<input type="radio" name="power" value="老师" class="role a" /><br/>
                        <div class="par">
                                学生姓名：<input class="form-control" type="text" placeholder="Name" id="childName" ><br>
                                就读学校：<input class="form-control" type="text" placeholder="School" id="childSchool"><br>
                                所在班级：<input class="form-control" type="text" placeholder="Class" id="childClass"><br>
                                培训机构：<input class="form-control" type="text" placeholder="Organization" id="Organization"><br>
                                辅导老师：<input type="text" class="form-control" id="Teacher" placeholder="Teacher"  /><br>
                                老师口令：<input type="text" class="form-control" id="Command" placeholder="Command"  />
                        </div>
                        <div class="tea" style="display: none;">
                            姓名：<input class="form-control" type="text" placeholder="Name" id="teacherName" ><br>
                            学校：<input class="form-control" type="text" placeholder="School" id="teacherSchool"><br>
                            班级口令：<input type="text" class="form-control" id="teacherCommand" placeholder="Command"  />
                        </div>
                        <div class="action">
                            <a class="btn btn-primary signup" id="signupBtn">提 交</a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script type = "text/javascript">
    $(document).ready(function() {
//        setCookie("role","11",-1);
//        alert(1);
        if (getCookie("tRes")=='yes') {
            alert("正在审核中");
//            window.location.href="common_fourPoint.html";
//            alert("1");
        }
        if (getCookie("role")) {
            alert("已经注册");
            window.location.href="common_fourPoint.html";
//            alert("1");
        }
        $('.b').click(function () {
            $('.par').css('display', 'block');
            $(".tea").css('display','none');
//            $('.username').html("姓名：");
        });
        $('.a').click(function () {
            $('.par').css('display', 'none');
            $(".tea").css('display','block');
//            $('.username').html("孩子姓名：");
        });
        //setCookie("openid","o45t9wZx7eQo5VIB4nTY_76TCW4w",20);
        $("#signupBtn").click(function () {
            var openid = getCookie('openid');
//        alert("注册:"+openid);
            var teacherName = $('#teacherName').val();
            var teacherSchool=$("#teacherSchool").val();
            var teacherCommand=$("#teacherCommand").val();
            var role = $('input.role:checked').val();
            var childName=$("#childName").val();
            var childSchool=$("#childSchool").val();
            var childClass=$("#childClass").val();
            var Organization=$("#Organization").val();
            var Teacher=$("#Teacher").val();
            var Command=$("#Command").val();
            var f = 0;

            if (role == "家长") {
                if (childName && role && childSchool &&childClass && Organization && Teacher && Command) {
                    f = 1;
                } else {;
                    alert("请填写完整信息");
                }
            } else {
                if (role && teacherName &&teacherSchool &&teacherCommand) {
                    f = 1;
                } else {
                    alert("请填写完整信息");
                }
            }
//        alert(role+sex);
            if (f == 1) {
                if(role == "老师"){
                    $.ajax({
                        url: '../starsea/user/register',
                        data: {
                            openId: openid,
                            teacherName:teacherName,
                            teacherSchool:teacherSchool,
                            teacherCommand:teacherCommand,
                            createTime:getNowFormatDate()
                        },
                        type: 'post',
                        cache: false,
                        dataType: 'json',
                        success: function (data) {
                            if (data.code == 200) {
                                alert("注册完成，请等待审核");
                                setCookie("tRes", "yes", 10000);
                                setCookie("bgColor", "lightgreen", 10000);
                                window.location.href = "common_fourPoint.html";
                            }
                            else {
                                alert("查询失败: " + data.msg);
                            }
                        },
                        error: function () {
                            alert("服务器处理异常");
                        }
                    });
                }else{
                    $.ajax({
                    url: '../starsea/user/parentSignup',//插入数据的接口
                    data: {
                        openId: openid,
                        name: childName,
                        school: childSchool,
                        myClass: childClass,
                        organization: Organization,
                        role: role,
                        teacher: Teacher,
                        command:Command,
                        createTime:getNowFormatDate()
                    },
                    type: 'post',
                    cache: false,
                    dataType: 'json',
                    success: function (data) {
                        if (data.code == 200) {
                            if(data['msg']['msg']==-1){
                                alert("注册失败");
                            }else{
                            alert("注册完成");
//                            setCookie("zhuce", "yes", 10000);
                                setCookie("bgColor", "lightgreen", 10000);
                            window.location.href = "common_fourPoint.html";}
                        }
                        else {
                            alert("查询失败: " + data.msg);
                        }
                    },
                    error: function () {
                        alert("服务器处理异常");
                    }
                });
                }
            }
        });

    });
</script>
</body>
</html>
